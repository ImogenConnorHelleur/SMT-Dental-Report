---
title: "Dental Data Pack - graphs only"
subtitle: "`r params$region_STP_name`"
author: "`r format(Sys.time(), '%B, %Y')`"
output: powerpoint_presentation
params:
  level: "National"
  region_STP_name: NULL
---


```{r include = FALSE}
library(tidyverse)
library(readxl)
source("../R/SMT_functions.R")
source("../R/format_SMT_data.R")

#load in raw data
UDA_calendar_data <- read_excel("../data/cleaned_data_up_to_february/UDA_calendar_data.xlsx")
UOA_calendar_data <- read_excel("../data/cleaned_data_up_to_february/UOA_calendar_data.xlsx")
UDA_scheduled_data <- read_excel("../data/cleaned_data_up_to_february/UDA_scheduled_data.xlsx")
UOA_scheduled_data <- read_excel("../data/cleaned_data_up_to_february/UOA_scheduled_data.xlsx")
historical_UDA_scheduled_data <- readRDS("../data/cleaned_data_up_to_september/historical_UDA_scheduled_data.rds")

UDA_calendar_data <- rename(UDA_calendar_data, month = data_month)
UOA_calendar_data <- UOA_calendar_data %>%
  rename(month = data_month) %>%
  mutate(contract_number = as.numeric(contract_number),
         UOA_total = as.numeric(UOA_total)) 

    #add a region column to the data
    region_STP_lookup <- UDA_calendar_data %>%
      select(contract_number, name_or_company_name, commissioner_name, region_name) %>%
      distinct()
    
    UOA_calendar_data <- left_join(UOA_calendar_data, region_STP_lookup, by = c("contract_number", "name_or_company_name", "commissioner_name"))

UDA_scheduled_data <- rename(UDA_scheduled_data, month = data_month)
UOA_scheduled_data <- rename(UOA_scheduled_data, month = data_month)

dental_data_111 <- readRDS("../data/cleaned_data_up_to_february/ dental_data_111.rds")

prototype_contracts <- read_excel("../data/prototype_contracts.xlsx")
contractor_categories <- readRDS("../data/cleaned_data_up_to_october/contractor_categories.RDS")

UDA_delivery_calendar <- get_into_slide5_7_format_calendar(STP_lines = T, renameColumns = T)
UDA_delivery_scheduled <- get_into_slide5_7_format(STP_lines = T, renameColumns = T)

#prototype_delivery <- readRDS("~/R-Projects/SMT-Dental-Report/data/prototype_delivery.RDS")
contract_demographics <- readRDS("~/R-Projects/SMT-Dental-Report/data/contract_demographics.rds")


```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```



## UDA activity data 
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_calendar(data = UDA_calendar_data, 
                                  scheduled_data = UDA_scheduled_data,
                                  contractor_cats = contractor_categories,
                                  UDAorUOA = "UDA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name,
                                  remove_prototypes = T,
                                  regional_lines = F, 
                                  STP_lines = F,
                                  cat_lines = F,
                                  plot_chart = T)
```



## UDA activity data by region
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_calendar(data = UDA_calendar_data,
                                  scheduled_data = UDA_scheduled_data,
                                  contractor_cats = contractor_categories,
                                  UDAorUOA = "UDA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name,
                                  remove_prototypes = T,
                                  regional_lines = T,
                                  STP_lines = F,
                                  cat_lines = F,
                                  plot_chart = T)
```


<!-- ## UDA activity data by STP -->
<!-- ```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8} -->
<!-- plot_UDA_UOA_delivery_calendar(data = UDA_calendar_data, -->
<!--                                   scheduled_data = UDA_scheduled_data, -->
<!--                                   contractor_cats = contractor_categories, -->
<!--                                   UDAorUOA = "UDA", -->
<!--                                   level = params$level, -->
<!--                                   region_STP_name = params$region_STP_name, -->
<!--                                   remove_prototypes = T, -->
<!--                                   regional_lines = F, -->
<!--                                   STP_lines = T, -->
<!--                                   cat_lines = F, -->
<!--                                   plot_chart = T) -->
<!-- ``` -->


## UDA activity data by MY Category
#### Prototypes and contracts with annual contracted UDAs < 100 included
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_calendar(data = UDA_calendar_data,
                                  scheduled_data = UDA_scheduled_data,
                                  contractor_cats = contractor_categories,
                                  UDAorUOA = "UDA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name,
                                  remove_prototypes = F,
                                  regional_lines = F,
                                  STP_lines = F,
                                  cat_lines = T,
                                  plot_chart = T)
```

## 
#### Prototypes and contracts with annual contracted UDAs < 100 excluded
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_calendar(data = UDA_calendar_data, 
                                  scheduled_data = UDA_scheduled_data,
                                  contractor_cats = contractor_categories,
                                  UDAorUOA = "UDA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name,
                                  remove_prototypes = T,
                                  regional_lines = F, 
                                  STP_lines = F,
                                  cat_lines = T,
                                  plot_chart = T)
```



## UDA cumulative activity data

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_Q3_cumulative_UDA_UOA_to_target(data = UDA_calendar_data,
                                  UDAorUOA = "UDA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name)
```




## Scheduled UDAs

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery(data = UDA_scheduled_data,  UDAorUOA = "UDA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name)
```



## Contract size to delivery comparison

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_delivery_vs_contract_size_scatter_corporate(data = UDA_scheduled_data,
                                                 demographics_data = contract_demographics,
                                                 remove_prototypes = T,
                                                 plot_month = NULL,
                                                 UDAorUOA = "UDA",
                                                 level = params$level,
                                                 region_STP_name = params$region_STP_name)
```




## UDA delivery profile

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_profile(data = UDA_scheduled_data,
                          calendar_data = UDA_calendar_data,
                          UDAorUOA = "UDA",
                          level = params$level,
                          region_STP_name = params$region_STP_name)
```



## UOA activity data

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_calendar(data = UOA_calendar_data, 
                                  scheduled_data = UOA_scheduled_data,
                                  contractor_cats = contractor_categories,
                                  UDAorUOA = "UOA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name,
                                  remove_prototypes = T,
                                  regional_lines = F, 
                                  STP_lines = F,
                                  cat_lines = F,
                                  plot_chart = T)
```




## UOA activity data by region
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_calendar(data = UOA_calendar_data,
                                  scheduled_data = UOA_scheduled_data,
                                  contractor_cats = contractor_categories,
                                  UDAorUOA = "UOA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name,
                                  remove_prototypes = T,
                                  regional_lines = T,
                                  STP_lines = F,
                                  cat_lines = F,
                                  plot_chart = T)
```

<!-- ## UOA activity data by STP -->
<!-- ```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8} -->
<!-- plot_UDA_UOA_delivery_calendar(data = UOA_calendar_data, -->
<!--                                   scheduled_data = UOA_scheduled_data, -->
<!--                                   contractor_cats = contractor_categories, -->
<!--                                   UDAorUOA = "UOA", -->
<!--                                   level = params$level, -->
<!--                                   region_STP_name = params$region_STP_name, -->
<!--                                   remove_prototypes = T, -->
<!--                                   regional_lines = F, -->
<!--                                   STP_lines = T, -->
<!--                                   cat_lines = F, -->
<!--                                   plot_chart = T) -->
<!-- ``` -->

## UOA activity data by MY Category
#### Prototypes and contracts with annual contracted UDAs < 100 included
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_calendar(data = UOA_calendar_data, 
                                  scheduled_data = UOA_scheduled_data,
                                  contractor_cats = contractor_categories,
                                  UDAorUOA = "UOA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name,
                                  remove_prototypes = F,
                                  regional_lines = F, 
                                  STP_lines = F,
                                  cat_lines = T,
                                  plot_chart = T)
```

##
#### Prototypes and contracts with annual contracted UDAs < 100 excluded
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_calendar(data = UOA_calendar_data, 
                                  scheduled_data = UOA_scheduled_data,
                                  contractor_cats = contractor_categories,
                                  UDAorUOA = "UOA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name,
                                  remove_prototypes = T,
                                  regional_lines = F, 
                                  STP_lines = F,
                                  cat_lines = T,
                                  plot_chart = T)
```



## UOA cumulative activity data

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_Q3_cumulative_UDA_UOA_to_target(data = UOA_calendar_data,
                                  UDAorUOA = "UOA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name)
```




## UOA delivery

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery(data = UOA_scheduled_data,
                      UDAorUOA = "UOA",
                                  level = params$level,
                                  region_STP_name = params$region_STP_name)
```



## UOA delivery profile

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_UDA_UOA_delivery_profile(data = UOA_scheduled_data,
                          calendar_data = UOA_calendar_data,
                          UDAorUOA = "UOA",
                          level = params$level,
                          region_STP_name = params$region_STP_name)
```



## Time series of banded Courses of Treatment
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=5, fig.width=8}
plot_banded_CoT(data = UDA_scheduled_data,
                calendar_data = UDA_calendar_data,
                historic_data = historical_UDA_scheduled_data,
                level = params$level,
                region_STP_name = params$region_STP_name)
```

## Urgent treatment form submissions

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_urgent_form_submissions(data = UDA_scheduled_data,
                calendar_data = UDA_calendar_data,
                historic_data = historical_UDA_scheduled_data,
                level = params$level,
                region_STP_name = params$region_STP_name)
```




## 111 dental related call volumes

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_111_referrals()
```


## 111 dental related call volumes by disposition

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.height=4, fig.width=8}
plot_breakdown_111_referrals()
```
